<eb-container padding="lg">
  <!-- Unified Grid Layout: 1 col mobile, 2 cols tablet, 4 cols desktop XL -->
  <eb-grid [cols]="1" [colsLg]="2" [colsXl]="4" gap="lg" class="home__layout" alignItems="stretch">
    <!-- Row 1: Hero (Span 2) & System Status (Span 2) -->

    <!-- Hero Section - Renders immediately with fallback values for optimal LCP -->
    <div class="home__col-span-2">
      <div class="home__hero">
        <h1 class="home__hero-name">{{ heroName() }}</h1>
        <h2 class="home__hero-title">{{ heroTitle() }}</h2>
        <p class="home__hero-tagline">{{ heroTagline() }}</p>
        <p class="home__hero-bio">{{ heroBio() }}</p>
        <div class="home__hero-actions">
          <eb-button
            routerLink="/profile"
            variant="primary"
            size="lg"
            [ariaLabel]="heroCtaProfile()"
          >
            {{ heroCtaProfile() }}
          </eb-button>
          <eb-button routerLink="/modules" variant="secondary" size="lg" [ariaLabel]="ctaButton()">
            {{ ctaButton() }}
          </eb-button>
        </div>
      </div>
    </div>

    <!-- System Status -->
    <ng-container *transloco="let t">
      <div class="home__col-span-2">
        <eb-stack spacing="md" class="h-full">
          <header class="dashboard__header">
            <h2 class="dashboard__title">{{ title() }}</h2>
            <p class="dashboard__subtitle">{{ subtitle() }}</p>
          </header>

          @if (store.error()) {
            <div class="error-alert">{{ store.error() }}</div>
          }

          @if (store.isLoading()) {
            <div class="loading-state">{{ t('home.systemStatus.loading') }}</div>
          } @else {
            @if (store.metrics(); as metrics) {
              <eb-card [hoverable]="false" class="h-full">
                <header card-header>
                  <div class="card-header--flex">
                    <h3 class="card-header__title">
                      {{ t('home.systemStatus.operationalStatus') }}
                    </h3>
                    <eb-badge
                      [variant]="metrics.systemStatus === 'operational' ? 'success' : 'error'"
                      [ariaLabel]="
                        t('home.systemStatus.operationalStatus') + ' ' + metrics.systemStatus
                      "
                      position="inline"
                      [content]="metrics.systemStatus | titlecase"
                    >
                    </eb-badge>
                  </div>
                </header>
                <div card-body>
                  <eb-stack spacing="md">
                    <div class="status__detail">
                      <span class="status__label">{{ t('home.systemStatus.buildStatus') }}</span>
                      <eb-badge
                        variant="secondary"
                        [ariaLabel]="t('home.systemStatus.buildStatus')"
                        position="inline"
                        [content]="metrics.buildStatus | titlecase"
                      ></eb-badge>
                    </div>
                    <div class="status__detail">
                      <span class="status__label">{{ t('home.systemStatus.deployStatus') }}</span>
                      <eb-badge
                        [variant]="metrics.deployStatus === 'success' ? 'success' : 'error'"
                        [ariaLabel]="t('home.systemStatus.deployStatus')"
                        position="inline"
                        [content]="metrics.deployStatus | titlecase"
                      >
                      </eb-badge>
                    </div>
                    <div class="status__detail">
                      <span class="status__label">{{ t('home.systemStatus.lastDeployed') }}</span>
                      <span class="status__value text-sm">{{
                        metrics.generatedAt | date: 'mediumDate'
                      }}</span>
                    </div>
                  </eb-stack>
                </div>
              </eb-card>
            }
          }
        </eb-stack>
      </div>

      <!-- Row 2: Test Coverage, Perf, Linting, Dependencies -->

      @if (store.metrics(); as metrics) {
        <!-- Test Coverage -->
        <eb-card [hoverable]="false" class="h-full">
          <header card-header>
            <h3 class="card-header__title">{{ t('home.projectHealth.testCoverage') }}</h3>
          </header>

          <div card-body>
            <eb-stack spacing="md">
              @if (
                metrics.extended.testCoverage.available && metrics.extended.testCoverage.details;
                as details
              ) {
                <div class="test-coverage__grid">
                  <!-- Total -->
                  <eb-donut-chart
                    [value]="metrics.extended.testCoverage.value ?? 0"
                    [total]="100"
                    [label]="t('home.projectHealth.average')"
                    [variant]="getScoreVariant(metrics.extended.testCoverage.value ?? 0)"
                    size="sm"
                  />
                  <!-- Statements -->
                  <eb-donut-chart
                    [value]="details.statements.pct"
                    [total]="100"
                    [label]="t('home.projectHealth.statements')"
                    [variant]="getScoreVariant(details.statements.pct)"
                    size="sm"
                  />
                  <!-- Functions -->
                  <eb-donut-chart
                    [value]="details.functions.pct"
                    [total]="100"
                    [label]="t('home.projectHealth.functions')"
                    [variant]="getScoreVariant(details.functions.pct)"
                    size="sm"
                  />
                  <!-- Lines -->
                  <eb-donut-chart
                    [value]="details.lines.pct"
                    [total]="100"
                    [label]="t('home.projectHealth.lines')"
                    [variant]="getScoreVariant(details.lines.pct)"
                    size="sm"
                  />
                </div>
              }
            </eb-stack>
          </div>

          <footer card-footer>
            <eb-button
              variant="secondary"
              size="sm"
              [fullWidth]="true"
              (click)="openCoverageReport()"
              [ariaLabel]="t('home.projectHealth.viewCoverage')"
            >
              {{ t('home.projectHealth.viewCoverage') }}
            </eb-button>
          </footer>
        </eb-card>

        <!-- Performance -->
        <eb-card [hoverable]="false" class="h-full">
          <header card-header>
            <h3 class="card-header__title">
              {{ t('home.projectHealth.perf') }} & {{ t('home.projectHealth.seo') }}
            </h3>
          </header>
          <div card-body>
            <eb-stack spacing="md">
              @if (metrics.extended.lighthouse; as lh) {
                @if (lh.available) {
                  <div class="lighthouse__grid">
                    <eb-donut-chart
                      [value]="lh.performance ?? 0"
                      [total]="100"
                      [label]="t('home.projectHealth.perf')"
                      [variant]="getScoreVariant(lh.performance ?? 0)"
                      size="sm"
                    />
                    <eb-donut-chart
                      [value]="lh.accessibility ?? 0"
                      [total]="100"
                      [label]="t('home.projectHealth.a11y')"
                      [variant]="getScoreVariant(lh.accessibility ?? 0)"
                      size="sm"
                    />
                    <eb-donut-chart
                      [value]="lh.bestPractices ?? 0"
                      [total]="100"
                      [label]="t('home.projectHealth.best')"
                      [variant]="getScoreVariant(lh.bestPractices ?? 0)"
                      size="sm"
                    />
                    <eb-donut-chart
                      [value]="lh.seo ?? 0"
                      [total]="100"
                      [label]="t('home.projectHealth.seo')"
                      [variant]="getScoreVariant(lh.seo ?? 0)"
                      size="sm"
                    />
                  </div>
                }
              }
            </eb-stack>
          </div>
          <footer card-footer>
            <eb-button
              variant="secondary"
              size="sm"
              [fullWidth]="true"
              (click)="openLighthouseReport()"
              [ariaLabel]="t('home.projectHealth.viewLighthouse')"
            >
              {{ t('home.projectHealth.viewLighthouse') }}
            </eb-button>
          </footer>
        </eb-card>

        <!-- Extended Metrics Row 2 continue -->
        @if (store.extendedMetrics(); as ext) {
          <!-- Linting -->
          @if (ext.linting.available) {
            <eb-card [hoverable]="false" class="h-full">
              <header card-header>
                <div class="card-header--flex">
                  <h3 class="card-header__title">{{ t('home.linting.title') }}</h3>
                  <eb-badge
                    [variant]="
                      ext.linting.errors === 0 && ext.linting.warnings === 0 ? 'success' : 'error'
                    "
                    position="inline"
                    [content]="
                      ext.linting.errors === 0 ? '✓ Clean' : ext.linting.errors + ' errors'
                    "
                    [ariaLabel]="t('home.linting.title')"
                  ></eb-badge>
                </div>
              </header>
              <div card-body>
                <eb-stack spacing="md">
                  <div class="metric__row">
                    <span class="metric__label">{{ t('home.linting.errors') }}</span>
                    <span class="metric__value">{{ ext.linting.errors }}</span>
                  </div>
                  <div class="metric__row">
                    <span class="metric__label">{{ t('home.linting.warnings') }}</span>
                    <span class="metric__value">{{ ext.linting.warnings }}</span>
                  </div>
                </eb-stack>
              </div>
              <footer card-footer>
                <eb-button
                  variant="secondary"
                  size="sm"
                  [fullWidth]="true"
                  (click)="openEslintConfig()"
                  [ariaLabel]="t('home.linting.viewConfig')"
                >
                  {{ t('home.linting.viewConfig') }}
                </eb-button>
              </footer>
            </eb-card>
          }
        }

        <!-- Latest Architecture Decisions -->
        <eb-card [hoverable]="false" class="h-full">
          <header card-header>
            <h3 class="card-header__title">{{ t('home.architecture.title') }}</h3>
          </header>

          <div card-body>
            <eb-stack spacing="md">
              @if (architectureStore.isLoading()) {
                <div class="loading-state">{{ t('home.architecture.loading') }}</div>
              } @else {
                <div class="adr-list">
                  @for (adr of architectureStore.entities() | slice: 0 : 3; track adr.id) {
                    <div class="adr-item" [routerLink]="['/architecture', adr.id]">
                      <div class="adr-item__header">
                        <span class="adr-item__title">{{ adr.title }}</span>
                        <eb-badge
                          [variant]="adr.status === 'accepted' ? 'success' : 'secondary'"
                          size="sm"
                          [content]="adr.status | titlecase"
                          position="inline"
                          [ariaLabel]="t('architecture.statusLabel', { status: adr.status })"
                        ></eb-badge>
                      </div>
                    </div>
                  }
                </div>
              }
            </eb-stack>
          </div>

          <footer card-footer>
            <eb-button
              routerLink="/architecture"
              variant="secondary"
              size="sm"
              [fullWidth]="true"
              [ariaLabel]="t('home.architecture.viewAllAria')"
            >
              {{ t('home.architecture.viewAll') }}
            </eb-button>
          </footer>
        </eb-card>

        @if (store.extendedMetrics(); as ext) {
          <!-- Bundle Size -->
          @if (ext.bundleSize.available && ext.bundleSize.initial; as bundle) {
            <eb-card [hoverable]="false" class="h-full">
              <header card-header>
                <div class="card-header--flex">
                  <h3 class="card-header__title">{{ t('home.bundleSize.title') }}</h3>
                  <eb-badge
                    [variant]="
                      bundle.status === 'pass'
                        ? 'success'
                        : bundle.status === 'warn'
                          ? 'warning'
                          : 'error'
                    "
                    position="inline"
                    [content]="t('home.bundleSize.status.' + bundle.status)"
                    [ariaLabel]="t('home.bundleSize.title')"
                  ></eb-badge>
                </div>
              </header>
              <div card-body>
                <eb-stack spacing="md">
                  <div class="metric__row">
                    <span class="metric__label">{{ t('home.bundleSize.initial') }}</span>
                    <span class="metric__value">{{ bundle.formatted }}</span>
                  </div>
                  <div class="metric__row">
                    <span class="metric__label">{{ t('home.bundleSize.budget') }}</span>
                    <span class="metric__value text-secondary">{{ bundle.budget }}</span>
                  </div>
                </eb-stack>
              </div>
              <footer card-footer>
                <eb-button
                  variant="secondary"
                  size="sm"
                  [fullWidth]="true"
                  (click)="openBundleReport()"
                  [ariaLabel]="t('home.bundleSize.viewMap')"
                >
                  {{ t('home.bundleSize.viewMap') }}
                </eb-button>
              </footer>
            </eb-card>
          }

          <!-- Row 3: Documentation, Decisions, Git -->

          <!-- Documentation -->
          @if (ext.documentation.available) {
            <eb-card [hoverable]="false" class="h-full">
              <header card-header>
                <div class="card-header--flex">
                  <h3 class="card-header__title">{{ t('home.documentation.title') }}</h3>
                  <eb-badge
                    [variant]="
                      (ext.documentation.components?.documented ?? 0) /
                        (ext.documentation.components?.total ?? 1) >
                      0.8
                        ? 'success'
                        : 'warning'
                    "
                    position="inline"
                    [content]="
                      (((ext.documentation.components?.documented ?? 0) /
                        (ext.documentation.components?.total ?? 1)) *
                        100 | number: '1.0-0') + '%'
                    "
                    [ariaLabel]="t('home.documentation.title')"
                  ></eb-badge>
                </div>
              </header>
              <div card-body>
                <eb-stack spacing="md">
                  <div class="metric__row">
                    <span class="metric__label">{{ t('home.documentation.components') }}</span>
                    <span class="metric__value"
                      >{{ ext.documentation.components?.documented }}/{{
                        ext.documentation.components?.total
                      }}</span
                    >
                  </div>
                  <div class="metric__row">
                    <span class="metric__label">{{ t('home.documentation.services') }}</span>
                    <span class="metric__value"
                      >{{ ext.documentation.services?.documented }}/{{
                        ext.documentation.services?.total
                      }}</span
                    >
                  </div>
                </eb-stack>
              </div>
              <footer card-footer>
                <eb-button
                  variant="secondary"
                  size="sm"
                  [fullWidth]="true"
                  (click)="openStorybook()"
                  [ariaLabel]="t('home.documentation.viewStorybook')"
                >
                  {{ t('home.documentation.viewStorybook') }}
                </eb-button>
              </footer>
            </eb-card>
          }

          <!-- Dependencies -->
          @if (ext.dependencies.available) {
            <eb-card [hoverable]="false" class="h-full">
              <header card-header>
                <div class="card-header--flex">
                  <h3 class="card-header__title">{{ t('home.dependencies.title') }}</h3>
                  <eb-badge
                    [variant]="
                      (ext.dependencies.vulnerabilities?.high ?? 0) > 0 ? 'error' : 'success'
                    "
                    position="inline"
                    [content]="
                      (ext.dependencies.vulnerabilities?.total ?? 0) === 0
                        ? '✓ Secure'
                        : (ext.dependencies.vulnerabilities?.total ?? 0) + ' issues'
                    "
                    [ariaLabel]="t('home.dependencies.title')"
                  ></eb-badge>
                </div>
              </header>
              <div card-body>
                <eb-stack spacing="md">
                  <div class="metric__row">
                    <span class="metric__label">{{ t('home.dependencies.total') }}</span>
                    <span class="metric__value">{{ ext.dependencies.total }}</span>
                  </div>
                  <div class="metric__row">
                    <span class="metric__label">{{ t('home.dependencies.outdated') }}</span>
                    <span class="metric__value">{{ ext.dependencies.outdated }}</span>
                  </div>
                  <div class="metric__row">
                    <span class="metric__label">{{ t('home.dependencies.vulnerabilities') }}</span>
                    <span class="metric__value">{{
                      ext.dependencies.vulnerabilities?.total ?? 0
                    }}</span>
                  </div>
                </eb-stack>
              </div>
            </eb-card>
          }
        }
        <!-- End Extended Metrics check -->

        <!-- Git Statistics -->
        @if (store.extendedMetrics(); as ext) {
          @if (ext.git.available) {
            <eb-card [hoverable]="false" class="h-full">
              <header card-header>
                <h3 class="card-header__title">{{ t('home.git.title') }}</h3>
              </header>
              <div card-body>
                <eb-stack spacing="md">
                  <div class="metric__row">
                    <span class="metric__label">{{ t('home.git.commits') }}</span>
                    <span class="metric__value">{{ ext.git.commits }}</span>
                  </div>
                  <div class="metric__row">
                    <span class="metric__label">{{ t('home.git.contributors') }}</span>
                    <span class="metric__value">{{ ext.git.contributors }}</span>
                  </div>
                  <div class="metric__row">
                    <span class="metric__label">{{ t('home.git.branches') }}</span>
                    <span class="metric__value">{{ ext.git.branches }}</span>
                  </div>
                </eb-stack>
              </div>
              <footer card-footer>
                <eb-button
                  variant="secondary"
                  size="sm"
                  [fullWidth]="true"
                  (click)="openRepository()"
                  [ariaLabel]="t('home.git.viewRepository')"
                >
                  {{ t('home.git.viewRepository') }}
                </eb-button>
              </footer>
            </eb-card>
          }
        }
      }
      <!-- End Metrics check (metrics) -->
    </ng-container>
  </eb-grid>
</eb-container>
